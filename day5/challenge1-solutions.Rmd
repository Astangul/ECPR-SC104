---
title: "Challenge 1: Analyzing the Amnesty International Annual Report"
author: Pablo Barbera
date: "August 4, 2017"
output: html_document
---

In this challenge you'll put your PDF-parsing skills to practice by analyzing the most recent [annual report](https://www.amnesty.org/en/latest/research/2017/02/amnesty-international-annual-report-201617/) from Amnesty International on the state of Human Rights in 159 countries.

Pick a country and use `pdftotext` to convert the text from the specific pages of the report that refer to that country.

``{r}
system("pdftotext -nopgbrk -f 109 -l 111 docs/amnesty.pdf")
```

Read the .txt file into R and use a combination of regular expressions and string parsing functions to remove the text that is not part of the report that corresponds to that country.

```{r}
txt <- readLines("docs/amnesty.txt")
txt <- txt[ (which(txt=="Canada")+1) : (grep("CENTRAL AFRICAN", txt)-1) ]
txt <- txt[ txt!="Amnesty International Report 2016/17" ]

```

Collapse the text into a single character vector and, using the text analysis techniques we learned on Wednesday, produce a word cloud of the most common words in the report.

```{r}
txt <- paste(txt, collapse=" ")
library(quanteda)
amnesty <- dfm(corpus(txt), remove=stopwords("english"), remove_punct=TRUE)
textplot_wordcloud(amnesty, rot.per=0, scale=c(2.5, .50), max.words=50)

```

(Optional) Parse the entire text of the report, and then extract the text referring to each country and create a data frame with the length (in words) of each country report. [Clue: try to find something that helps you "anchor" the beginning of each country.] Which is the country with the longest report?


```{r}
# Sketch of a solution:
system("pdftotext -nopgbrk docs/amnesty.pdf")
txt <- readLines("docs/amnesty.txt")

anchors <- grep("Head of state", txt)
countries <- txt[anchors-1]

report <- c()

for (i in 1:(length(anchors)-1)){
		
	r <- txt[ (anchors[i]+2) : (anchors[i+1]-3) ]
	r <- paste(r, collapse=" ")

	words <- length(tokenize(r)[[1]])

	report <- rbind(report,
		data.frame(country=countries[i], words=words, text=r, 
		stringsAsFactors=F))
}

report$country[which.max(report$words)]

```



